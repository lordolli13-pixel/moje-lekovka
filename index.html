<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Budík</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen p-5">

    <h1 class="text-2xl font-bold mb-5">Test Budíku</h1>
    
    <input type="time" id="cas" class="bg-slate-800 border border-slate-700 p-4 rounded-xl text-3xl mb-5">
    
    <button onclick="nastavitBudik()" class="bg-blue-600 hover:bg-blue-500 px-8 py-4 rounded-xl font-bold uppercase tracking-wider">
        Nastavit budík
    </button>

    <div id="status" class="mt-10 text-slate-400 text-sm italic text-center"></div>

    <script>
        // Registrace SW
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                document.getElementById('status').innerText = 'Systém připraven (SW aktivní)';
            });
        }

        // Žádost o notifikace
        function nastavitBudik() {
            const vybranyCas = document.getElementById('cas').value;
            if (!vybranyCas) return alert('Vyber čas!');

            Notification.requestPermission().then(perm => {
                if (perm === 'granted') {
                    // Poslat čas do Service Workera
                    if (navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({
                            type: 'SET_ALARM',
                            time: vybranyCas
                        });
                        alert('Budík nastaven na ' + vybranyCas + '. Teď aplikaci zavři a počkej.');
                    } else {
                        alert('Chyba: SW ještě neřídí stránku. Zkus stránku obnovit (F5).');
                    }
                } else {
                    alert('Musíš povolit notifikace!');
                }
            });
        }
    </script>
</body>
</html>
